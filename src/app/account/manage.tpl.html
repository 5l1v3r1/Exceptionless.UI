<div class="hbox hbox-auto-xs hbox-auto-sm">
  <div class="col" refresh-on="UserChanged" refresh-action="vm.getUser()" refresh-debounce="1000">
    <div class="wrapper-md">
      <div class="panel panel-default">
        <div class="panel-heading"><i class="fa fa-th-list"></i> My Account</div>
        <div class="panel-body">
          <tabset class="tab-container">
            <tab heading="General">
              <form name="userForm" role="form" class="form-validation">
                <div class="form-group">
                  <img gravatar-src="vm.user.email_address" gravatar-size="100" alt="{{vm.user.full_name}}">
                  <div>
                    <small>
                      Your avatar is generated by requesting a <a href="https://gravatar.com" target="_blank">Gravatar image</a> with the email address below.
                    </small>
                  </div>
                </div>

                <div class="form-group">
                  <label for="name">Full Name</label>
                  <input id="name" name="name" type="text" class="form-control"
                         placeholder="Your first and last name"
                         ng-model="vm.user.full_name"
                         ng-model-options="{ debounce: 1000 }"
                         ng-change="vm.saveUser(userForm.$valid)"
                         required />

                  <div class="error" ng-messages="userForm.name.$error" ng-if="userForm.$submitted || userForm.name.$touched">
                    <small ng-message="required">Full Name is required.</small>
                  </div>
                </div>

                <div class="form-group">
                  <label for="email">Email Address</label>
                  <input id="email" name="email" type="email" class="form-control"
                         placeholder="Email Address"
                         ng-model="vm.user.email_address"
                         ng-model-options="{ debounce: 1000 }"
                         ng-change="vm.saveEmailAddress(userForm.$valid)"
                         required/>

                  <div class="error" ng-messages="userForm.email.$error" ng-if="userForm.$submitted || userForm.email.$touched">
                    <small ng-message="required">Email Address is required.</small>
                    <small ng-message="email">Email Address is required.</small>
                    <small ng-message="unique">A user already exists with this email address.</small>
                  </div>

                  <p ng-if="!vm.user.is_email_address_verified" class="help-block">
                    Email not verified. <a ng-click="vm.resendVerificationEmail()">Resend</a> verification email.
                  </p>
                </div>

                <div class="line line-dashed b-b line-lg pull-in"></div>
                <div class="form-group">
                  <a ui-sref="app.dashboard" type="button" role="button" class="btn btn-default">Go To Dashboard</a>
                </div>
              </form>
            </tab>
            <tab heading="Notifications">
              <form role="form" class="form-validation">
                <div class="alert in fade alert-info" ng-if="!vm.user.email_notifications_enabled">
                  Email notifications are currently disabled.
                </div>
                <div class="checkbox">
                  <label class="i-checks">
                    <input type="checkbox"
                           ng-model="vm.user.email_notifications_enabled"
                           ng-model-options="{ debounce: 1000 }"
                           ng-change="vm.saveEnableEmailNotification()">
                    <i></i>
                    Enable email notifications
                  </label>
                </div>

                <div ng-if="vm.hasProjects()">
                  <hr/>
                  <select class="form-control"
                          ng-model="vm.currentProject"
                          ng-change="vm.getEmailNotificationSettings()"
                          ng-options="project.name group by project.organization_name for project in vm.projects"></select>

                  <div class="checkbox">
                    <label class="i-checks">
                      <input type="checkbox"
                             ng-model="vm.emailNotificationSettings.send_daily_summary"
                             ng-model-options="{ debounce: 1000 }"
                             ng-change="vm.saveEmailNotificationSettings()"
                             ng-disabled="!vm.hasEmailNotifications()">
                      <i></i>
                      Send daily project summary
                    </label>
                  </div>


                  <hr ng-if="!vm.hasPremiumFeatures()"/>
                  <div class="alert in fade alert-success" ng-if="!vm.hasPremiumFeatures()">
                    <a href="javascript:void(0);">Upgrade now</a> to enable occurrence level notifications!
                  </div>

                  <div class="checkbox">
                    <label class="i-checks">
                      <input type="checkbox"
                             ng-model="vm.emailNotificationSettings.report_critical_errors"
                             ng-model-options="{ debounce: 1000 }"
                             ng-change="vm.saveEmailNotificationSettings()"
                             ng-disabled="!vm.hasPremiumEmailNotifications()">
                      <i></i>
                      Notify me on critical events
                    </label>
                  </div>

                  <div class="checkbox">
                    <label class="i-checks">
                      <input type="checkbox"
                             ng-model="vm.emailNotificationSettings.report_regressions"
                             ng-model-options="{ debounce: 1000 }"
                             ng-change="vm.saveEmailNotificationSettings()"
                             ng-disabled="!vm.hasPremiumEmailNotifications()">
                      <i></i>
                      Notify me on event regressions
                    </label>
                  </div>

                  <hr/>

                  <p>Choose how often you want to receive notifications for error occurrences in this project.</p>

                  <div class="form-group">
                    <div class="btn-group">
                      <label class="btn btn-default"
                             btn-radio="0"
                             ng-model="vm.emailNotificationSettings.mode"
                             ng-change="vm.saveEmailNotificationSettings()"
                             ng-disabled="!vm.hasPremiumEmailNotifications()"
                             uncheckable>Never</label>
                      <label class="btn btn-default"
                             btn-radio="1"
                             ng-model="vm.emailNotificationSettings.mode"
                             ng-change="vm.saveEmailNotificationSettings()"
                             ng-disabled="!vm.hasPremiumEmailNotifications()"
                             uncheckable>New Only</label>
                      <label class="btn btn-default"
                             btn-radio="2"
                             ng-model="vm.emailNotificationSettings.mode"
                             ng-change="vm.saveEmailNotificationSettings()"
                             ng-disabled="!vm.hasPremiumEmailNotifications()"
                             uncheckable>All Occurrences</label>
                    </div>
                  </div>

                  <div ng-if="vm.currentProject.mode > 0">
                    <div class="checkbox">
                      <label class="i-checks">
                        <input type="checkbox"
                               ng-model="vm.emailNotificationSettings.report_known_bot_events"
                               ng-model-options="{ debounce: 1000 }"
                               ng-change="vm.saveEmailNotificationSettings()"
                               ng-disabled="!vm.hasPremiumEmailNotifications()">
                        <i></i>
                        Notify me on events from known bots
                      </label>
                    </div>

                    <div class="checkbox">
                      <label class="i-checks">
                        <input type="checkbox"
                               ng-model="vm.emailNotificationSettings.report_404_events"
                               ng-model-options="{ debounce: 1000 }"
                               ng-change="vm.saveEmailNotificationSettings()"
                               ng-disabled="!vm.hasPremiumEmailNotifications()">
                        <i></i>
                        Notify me on 404 events
                      </label>
                    </div>
                  </div>

                  <div class="line line-dashed b-b line-lg pull-in"></div>
                  <div class="form-group">
                    <a ui-sref="app.project-dashboard({ projectId: vm.currentProject.id })" type="button" role="button" class="btn btn-default">Go To Dashboard</a>
                  </div>
                </div>
              </form>
            </tab>
            <tab heading="Password">
              <form name="vm.passwordForm" role="form" class="form-validation">
                <div class="form-group" ng-if="vm.hasLocalAccount()">
                  <label for="current">Current Password</label>
                  <input id="current" name="current" type="password" class="form-control" ng-model="vm.password.current_password" required />

                  <div class="error" ng-messages="vm.passwordForm.current.$error" ng-if="vm.passwordForm.$submitted || vm.passwordForm.current.$touched">
                    <small ng-message="required">Current Password is required.</small>
                  </div>
                </div>

                <div class="form-group">
                  <label for="newPassword">New Password</label>
                  <input id="newPassword" name="newPassword" type="password" class="form-control" ng-model="vm.password.password" ng-minlength="6" ng-maxlength="100" required />

                  <div class="error" ng-messages="vm.passwordForm.newPassword.$error" ng-if="vm.passwordForm.$submitted || vm.passwordForm.newPassword.$touched">
                    <small ng-message="required">New Password is required.</small>
                    <small ng-message="minlength">New Password must be at least 6 characters long.</small>
                    <small ng-message="maxlength">New Password must be less than 101 characters long.</small>
                  </div>
                </div>

                <div class="form-group">
                  <label for="confirmPassword">Confirm password</label>
                  <input id="confirmPassword" name="confirmPassword" type="password" class="form-control" ng-model="vm.password.confirm_password" match="vm.password.password" ng-minlength="6" ng-maxlength="100" required />

                  <div class="error" ng-messages="vm.passwordForm.confirmPassword.$error" ng-if="vm.passwordForm.$submitted || vm.passwordForm.confirmPassword.$touched">
                    <small ng-message="match">New Password and Confirmation Password fields do not match.</small>
                    <small ng-message="required">Confirm Password is required.</small>
                    <small ng-message="minlength">Confirm Password must be at least 6 characters long.</small>
                    <small ng-message="maxlength">Confirm Password must be less than 101 characters long.</small>
                  </div>
                </div>

                <div class="line line-dashed b-b line-lg pull-in"></div>
                <div class="form-group">
                  <a ui-sref="app.dashboard" type="button" role="button" class="btn btn-default">Go To Dashboard</a>
                  <div class="pull-right">
                    <input ng-click="vm.changePassword(vm.passwordForm.$valid)" type="submit" class="btn btn-primary" value="{{vm.hasLocalAccount() ? 'Change Password' : 'Set Password'}}" />
                  </div>
                </div>
              </form>
            </tab>
            <tab heading="External Logins">
              <h4>Add an external login</h4>

              <div>
                <button type="button" ng-click="vm.authenticate('live')" class="btn btn-large image-button icon-login-microsoft" title="Log in using your Microsoft account"></button>
                <button type="button" ng-click="vm.authenticate('google')" class="btn btn-large image-button icon-login-google" title="Log in using your Google account"></button>
                <button type="button" ng-click="vm.authenticate('facebook')" class="btn btn-large image-button icon-login-facebook" title="Log in using your Facebook account"></button>
                <button type="button" ng-click="vm.authenticate('github')" class="btn btn-large image-button icon-login-github" title="Log in using your GitHub account"></button>
              </div>

              <h4>Existing external logins</h4>
              <div class="table-responsive">
                <table class="table table-striped table-bordered table-fixed b-t b-light">
                  <thead>
                    <tr>
                      <th>Name</th>
                      <th class="action" ng-hide="!vm.hasOAuthAccounts() || !vm.canRemoveOAuthAccount()">Action</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr ng-repeat="account in vm.user.o_auth_accounts track by account.provider_user_id" ng-if="vm.hasOAuthAccounts()">
                      <td>{{::account.provider}} ({{::account.username || account.provider_user_id}})</td>
                      <td ng-hide="!vm.canRemoveOAuthAccount()">
                        <button type="button" role="button" class="btn btn-sm" title="Remove" ng-click="vm.unlink(account)">
                          <i class="fa fa-times"></i>
                        </button>
                      </td>
                    </tr>
                    <tr ng-if="!vm.hasOAuthAccounts()">
                      <td colspan="2">
                        <strong>No external logins were found.</strong>
                      </td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </tab>
          </tabset>
        </div>
      </div>
    </div>
  </div>
</div>
