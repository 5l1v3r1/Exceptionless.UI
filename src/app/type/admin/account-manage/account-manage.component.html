<div class="hbox hbox-auto-xs hbox-auto-sm">
    <div class="col">
        <div class="wrapper-md">
            <div class="panel panel-default">
                <div class="panel-heading"><i class="fa fa-user"></i> My Account</div>

                <div class="panel-body m-b-n">
                    <ngb-tabset class="tab-container">
                        <ngb-tab title="General">
                            <ng-template ngbTabContent>
                                <form name="fullNameForm" role="form" class="form-validation" autocomplete="on">
                                    <div class="form-group">
                                        <img src="//www.gravatar.com/avatar/2c356e305447c597ed0d3c3c16db5bf3?default=mm&size=100" alt="{{ user['full_name'] }}" gravatar-size="100" alt="avatar" class="img-thumbnail">
                                        <div>
                                            <small [innerHTML]="'NOTICE_GRAVATAR'"></small>
                                        </div>
                                    </div>

                                    <div class="form-group">
                                        <label for="name">Full Name</label>
                                        <input id="name" name="name" type="text" class="form-control" x-autocompletetype="full-name" autocapitalize="words" autocorrect="off" spellcheck="false"
                                               placeholder="Your first and last name"
                                               [(ngModel)]="user['full_name']"
                                               ng-change="vm.saveUser(fullNameForm.$valid)"
                                               required
                                               #name="ngModel"/>

                                        <div class="error" *ngIf="(name.invalid && (name.dirty || name.touched)) || submitted">
                                            <small [hidden]="!name.errors?.required">Full Name is required.</small>
                                        </div>
                                    </div>
                                </form>

                                <form name="emailAddressForm" role="form" class="form-validation" autocomplete="on" #emailAddressForm="ngForm">
                                    <div class="form-group">
                                        <label for="email">Email Address</label>
                                        <div [ngClass]="{'input-group': !!emailAddressForm.pending }">
                                            <input id="email" name="email" type="email" class="form-control" x-autocompletetype="email" autocorrect="off" spellcheck="false"
                                                   placeholder="Email Address"
                                                   [(ngModel)]="user['email_address']"
                                                   ng-change="vm.saveEmailAddress()"
                                                   required
                                                   #email="ngModel"/>

                                            <span class="input-group-addon" *ngIf="emailAddressForm.pending">
                                                <i class="fa fa-fw fa-spinner fa-spin"></i>
                                            </span>
                                        </div>

                                        <div class="error" *ngIf="(email.invalid && (email.dirty || email.touched)) || submitted">
                                            <small [hidden]="!email.errors?.required">Email Address is required.</small>
                                            <small [hidden]="!email.errors?.email" *ngIf="!email.errors?.required">It muse be email address.</small>
                                        </div>

                                        <p *ngIf="!user['is_email_address_verified']" class="help-block">Email not verified. <a (click)="resendVerificationEmail()">Resend</a> verification email.</p>
                                    </div>
                                </form>
                            </ng-template>
                        </ngb-tab>

                        <ngb-tab title="Notifications">
                            <ng-template ngbTabContent>
                                <form role="form" class="form-validation" #notificationForm="ngForm">
                                    <div class="alert in fade alert-danger" *ngIf="!user['is_email_address_verified'] || !user['email_notifications_enabled']">
                                        Email notifications are currently disabled. <span *ngIf="!user['is_email_address_verified']">To enable email notifications you must first verify your email address. <a (click)="resendVerificationEmail()">Resend</a> verification email.</span>
                                    </div>
                                    <div class="checkbox">
                                        <label class="checks">
                                            <input name="email-notifications-enabled" type="checkbox" [(ngModel)]="user['email_notifications_enabled']" ng-change="vm.saveEnableEmailNotification()">
                                            <i></i>
                                            Enable email notifications
                                        </label>
                                    </div>

                                    <div *ngIf="projects.length > 0">
                                        <hr/>

                                        <p>Choose how often you want to receive notifications for event occurrences in this project.</p>

                                        <select class="form-control" name="current-project" [(ngModel)]="currentProject['id']" ng-change="vm.getEmailNotificationSettings()" [disabled]="!(user['email_notifications_enabled'] && emailNotificationSettings != {})">
                                            <optgroup *ngFor="let project of projects" label="{{ project['organization_name'] }}">
                                                <option *ngFor="let loopItem of filterProject(project['organization_name'])" [ngValue]="loopItem['id']">{{ loopItem['name'] }}</option>
                                            </optgroup>
                                        </select>

                                        <div class="checkbox">
                                            <label class="checks">
                                                <input type="checkbox" name="send_daily_summary" [(ngModel)]="emailNotificationSettings['send_daily_summary']" ng-change="vm.saveEmailNotificationSettings()" [disabled]="!(user['email_notifications_enabled'] && emailNotificationSettings)">
                                                <i></i>
                                                Send daily project summary
                                            </label>
                                        </div>

                                        <hr *ngIf="!hasPremiumFeatures"/>
                                        <div class="alert in fade alert-success" *ngIf="!hasPremiumFeatures">
                                            <a (click)="showChangePlanDialog()">Upgrade now</a> to enable occurrence level notifications!
                                        </div>

                                        <div class="checkbox">
                                            <label class="checks">
                                                <input type="checkbox" name="report_new_errors" [(ngModel)]="emailNotificationSettings['report_new_errors']" ng-change="vm.saveEmailNotificationSettings()" [disabled]="!hasPremiumEmailNotifications()">
                                                <i></i>
                                                Notify me on new errors
                                            </label>
                                        </div>

                                        <div class="checkbox">
                                            <label class="checks">
                                                <input type="checkbox" name="report_critical_errors" [(ngModel)]="emailNotificationSettings['report_critical_errors']" ng-change="vm.saveEmailNotificationSettings()" [disabled]="!hasPremiumEmailNotifications()">
                                                <i></i>
                                                Notify me on critical errors
                                            </label>
                                        </div>

                                        <div class="checkbox">
                                            <label class="checks">
                                                <input type="checkbox" name="report_event_regressions" [(ngModel)]="emailNotificationSettings['report_event_regressions']" ng-change="vm.saveEmailNotificationSettings()" [disabled]="!hasPremiumEmailNotifications()">
                                                <i></i>
                                                Notify me on error regressions
                                            </label>
                                        </div>

                                        <div class="checkbox">
                                            <label class="checks">
                                                <input type="checkbox" name="report_new_events" [(ngModel)]="emailNotificationSettings['report_new_events']" ng-change="vm.saveEmailNotificationSettings()" [disabled]="!hasPremiumEmailNotifications()">
                                                <i></i>
                                                Notify me on new events
                                            </label>
                                        </div>

                                        <div class="checkbox">
                                            <label class="checks">
                                                <input type="checkbox" name="report_critical_events" [(ngModel)]="emailNotificationSettings['report_critical_events']" ng-change="vm.saveEmailNotificationSettings()" [disabled]="!hasPremiumEmailNotifications()">
                                                <i></i>
                                                Notify me on critical events
                                            </label>
                                        </div>
                                    </div>
                                </form>
                            </ng-template>
                        </ngb-tab>

                        <ngb-tab title="Password">
                            <ng-template ngbTabContent>
                                <form name="vm.passwordForm" role="form" class="form-validation">
                                    <div class="form-group" ng-if="vm.hasLocalAccount">
                                        <label for="current">Current Password</label>
                                        <input id="current" name="current" type="password" class="form-control" ng-model="vm.password.current_password" required />

                                        <div class="error" ng-messages="vm.passwordForm.current.$error" ng-if="vm.passwordForm.$submitted || vm.passwordForm.current.$touched">
                                            <!--<small ng-message="required">Current Password is required.</small>-->
                                        </div>
                                    </div>

                                    <div class="form-group">
                                        <label for="newPassword">New Password</label>
                                        <input id="newPassword" name="newPassword" type="password" class="form-control" ng-model="vm.password.password" ng-minlength="6" ng-maxlength="100" required />

                                        <div class="error" ng-messages="vm.passwordForm.newPassword.$error" ng-if="vm.passwordForm.$submitted || vm.passwordForm.newPassword.$touched">
                                            <!--<small ng-message="required">{{::'New Password is required.' | translate}}</small>
                                            <small ng-message="minlength">{{::'New Password must be at least 6 characters long.' | translate}}</small>
                                            <small ng-message="maxlength">{{::'New Password must be less than 101 characters long.' | translate}}</small>-->
                                        </div>
                                    </div>

                                    <div class="form-group">
                                        <label for="confirmPassword">Confirm password</label>
                                        <input id="confirmPassword" name="confirmPassword" type="password" class="form-control" ng-model="vm.password.confirm_password" match="vm.password.password" ng-minlength="6" ng-maxlength="100" ng-required="true" />

                                        <div class="error" ng-messages="vm.passwordForm.confirmPassword.$error" ng-if="vm.passwordForm.$submitted || vm.passwordForm.confirmPassword.$touched">
                                            <!--<small ng-message="match">{{::'New Password and Confirmation Password fields do not match.' | translate}}</small>
                                            <small ng-message="required">{{::'Confirm Password is required.' | translate}}</small>
                                            <small ng-message="minlength">{{::'Confirm Password must be at least 6 characters long.' | translate}}</small>
                                            <small ng-message="maxlength">{{::'Confirm Password must be less than 101 characters long.' | translate}}</small>-->
                                        </div>
                                    </div>

                                    <button type="submit" role="button" class="btn btn-primary" promise-button="vm.changePassword(vm.passwordForm.$valid)" promise-button-busy-text="Changing Password">Change Password</button>
                                </form>
                            </ng-template>
                        </ngb-tab>

                        <ngb-tab title="External Logins">
                            <ng-template ngbTabContent>
                                <h4>Add an external login</h4>

                                <div>
                                    <button type="button" role="button" ng-click="vm.authenticate('live')" ng-if="vm.isExternalLoginEnabled('live')" class="btn btn-large image-button icon-login-microsoft" title="Log in using your Microsoft account"></button>
                                    <button type="button" role="button" ng-click="vm.authenticate('google')" ng-if="vm.isExternalLoginEnabled('google')" class="btn btn-large image-button icon-login-google" title="Log in using your Google account"></button>
                                    <button type="button" role="button" ng-click="vm.authenticate('facebook')" ng-if="vm.isExternalLoginEnabled('facebook')" class="btn btn-large image-button icon-login-facebook" title="Log in using your Facebook account"></button>
                                    <button type="button" role="button" ng-click="vm.authenticate('github')" ng-if="vm.isExternalLoginEnabled('github')" class="btn btn-large image-button icon-login-github" title="Log in using your GitHub account"></button>
                                </div>

                                <h4>Existing external logins</h4>
                                <div class="table-responsive">
                                    <table class="table table-striped table-bordered table-fixed b-t">
                                        <thead>
                                        <tr>
                                            <th>Name</th>
                                            <th class="action">Actions</th>
                                        </tr>
                                        </thead>
                                        <tbody>
                                        <tr ng-repeat="account in vm.user.o_auth_accounts" ng-if="vm.user.o_auth_accounts.length > 0">
                                            <td>   </td>
                                            <td>
                                                <button type="button" role="button" class="btn btn-sm" title="Remove" ng-disabled="!(vm.hasLocalAccount || vm.user.o_auth_accounts.length > 1)" ng-click="vm.unlink(account)">
                                                    <i class="fa fa-times"></i>
                                                </button>
                                            </td>
                                        </tr>
                                        <tr ng-if="vm.user.o_auth_accounts.length === 0">
                                            <td colspan="2">
                                                <strong>No external logins were found.</strong>
                                            </td>
                                        </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </ng-template>
                        </ngb-tab>
                    </ngb-tabset>
                </div>

                <footer class="panel-footer">
                    <div class="pull-right">
                        <div ng-if="!vm.currentProject.id">
                            <a ui-sref="app.dashboard" class="btn btn-default" role="button">Go To Dashboard</a>
                        </div>
                        <!--<div ng-if="vm.currentProject.id">
                            <a ui-sref="app.project-dashboard({ projectId: vm.currentProject.id })" class="btn btn-default" role="button">Go To Dashboard</a>
                        </div>-->
                    </div>
                    <div>
                        <a ng-click="vm.deleteAccount()" class="btn btn-danger" role="button">DELETE ACCOUNT</a>
                    </div>
                    <div class="clearfix"></div>
                </footer>
            </div>
        </div>
    </div>
</div>
