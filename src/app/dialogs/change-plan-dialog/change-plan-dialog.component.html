<form name="changePlanForm" role="form" class="form-validation">
    <div class="alert alert-danger" role="alert" *ngIf="paymentMessage">
        <i class="fas fa-exclamation"></i>
        {{paymentMessage}}
    </div>

    <div class="form-group" *ngIf="organizations.length > 1">
        <label for="organization">{{'Organization to change' | translate}}</label>
        <select id="organization" class="form-control" [(ngModel)]="currentOrganization" (ngModelChange)="changeOrganization()" [disabled]="!isBillingEnabled()">
            <option *ngFor="let item of organizations">{{item.name}}</option>
        </select>
    </div>

    <p [innerHTML] = "'Organization_Payment_Plan' | translate:{organization: currentOrganization.name, planName: currentOrganization.plan_name}"></p>

    <div class="form-group">
        <label for="plan" [innerHTML]="'Payment_Select_New_Plan' | translate"></label>

        <select id="plan" class="form-control" [(ngModel)]="currentPlan" [disabled]="!isBillingEnabled()">
            <option *ngFor="let item of plans">{{item.description}}</option>
        </select>
    </div>

    <div *ngIf="isPaidPlan()">
        <div *ngIf="!hasAdminRole()">
            <h4>{{'Credit Card' | translate}}</h4>
            <div class="row" *ngIf="hasExistingCard()">
                <div class="form-group col-sm-6">
                    <div class="radio">
                        <label class="checks">
                            <input type="radio" class="form-control" [(ngModel)]="card.mode" [disabled]="!isBillingEnabled()"  value="existing"/>
                            <i></i> {{'Credit_Card_Ending' | translate: currentOrganization }}
                        </label>
                    </div>
                </div>

                <div class="form-group col-sm-6">
                    <div class="radio">
                        <label class="checks">
                            <input type="radio" class="form-control" [(ngModel)]="card.mode" [disabled]="isBillingEnabled()" value="new" />
                            <i></i> {{'Use a new credit card' | translate}}
                        </label>
                    </div>
                </div>
            </div>

            <div *ngIf="isNewCard()">
                <div class="row">
                    <div class="form-group col-xs-8">
                        <label for="cardNumber">{{'Card number' | translate}}</label>
                        <div class="input-group">
                            <input id="cardNumber" type="text" class="form-control" placeholder="•••• •••• •••• ••••"
                                   x-autocompletetype="cc-number"
                                   [(ngModel)]="card.number"
                                   payments-validate="card"
                                   payments-format="card"
                                   payments-type-model="card.type"
                                   [disabled]="!isBillingEnabled()"
                                   required />
                            <span class="input-group-addon"><img src="/img/cards/{{ card.type ? card.type : 'placeholder' }}.png" alt="Card Type" /></span>
                        </div>
                    </div>

                    <div class="form-group col-xs-4">
                        <label for="cardExpiry">{{'Expires' | translate}}</label>
                        <input id="cardExpiry" type="text" class="form-control" placeholder="MM / YY"
                               x-autocompletetype="cc-exp"
                               [(ngModel)]="card.expiry"
                               [disabled]="!isBillingEnabled()"
                               payments-validate="expiry"
                               payments-format="expiry"
                               required />
                    </div>
                </div>

                <div class="row">
                    <div class="form-group col-xs-8">
                        <label for="cardName">{{'Name on card' | translate}}</label>
                        <input id="cardName" type="text" class="form-control" placeholder="{{'Name on card' | translate}}"
                               x-autocompletetype="full-name" autocapitalize="words" autocorrect="off" spellcheck="false"
                               [(ngModel)]="card.name"
                               [disabled]="!isBillingEnabled()"
                               required />
                    </div>

                    <div class="form-group col-xs-4">
                        <label for="cardCVC">{{'Card code' | translate}}</label>
                        <input id="cardCVC" type="text" class="form-control" placeholder="CVC"
                               x-autocompletetype="cc-csc" autocomplete="off"
                               [(ngModel)]="card.cvc"
                               [disabled]="!isBillingEnabled()"
                               payments-validate="cvc"
                               payments-format="cvc"
                               payments-type-model="vm.card.type"
                               required />
                    </div>
                </div>
            </div>
        </div>

        <div class="form-group"  *ngIf="!hasExistingCard()">
            <label for="couponId">{{'Coupon code' | translate}}</label>
            <input id="couponId" type="text" class="form-control" placeholder="{{'Coupon code' | translate}}" [(ngModel)]="coupon" [disabled]="!isBillingEnabled()" />
        </div>
    </div>

    <div *ngIf="isCancellingPlan()">
        <p><strong>{{'Help us improve Exceptionless!' | translate}}</strong></p>
        <p>
            We hate to see you downgrade, but we'll be more than happy to take care of that for you.
            Use the <a (click)="showIntercom()">Contact Us</a> button below to let us know why you're downgrading,
            so we can serve you better in the future.
        </p>
    </div>
</form>
