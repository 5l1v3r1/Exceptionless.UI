<organization-notifications organization-id="vm.event.organization_id"></organization-notifications>

<div class="hbox hbox-auto-xs hbox-auto-sm" refresh-on="PersistentEventChanged PlanChanged" refresh-action="vm.get(data)" refresh-throttle="1000">
  <div class="wrapper-md" refresh-on="filterChanged" refresh-action="vm.get()">
    <div class="row">
      <div class="col-sm-12">
        <div class="row row-sm text-center">
          <div class="col-xs-4">
            <div class="dashboard-block">
              <div class="rotate">
                <i class="fa fa-calendar fa-4x"></i>
              </div>
              <div class="details">
                <span class="title">Events</span>
                <span class="sub">{{vm.stats.total || 0 | number : 0}}</span>
              </div>
            </div>
          </div>
          <div class="col-xs-4">
            <div class="dashboard-block">
              <div class="rotate">
                <i class="fa fa-arrow-circle-left fa-4x"></i>
              </div>
              <div class="details">
                <span class="title">Start</span>
                <span class="sub visible-md visible-lg"><timeago date="vm.stats.first_occurrence"></timeago></span>
                <span class="sub visible-sm">
                  <span ng-if="vm.isValidDate(vm.stats.first_occurrence)">{{vm.stats.first_occurrence | date:'shortDate' }}</span>
                  <span ng-if="!vm.isValidDate(vm.stats.first_occurrence)">never</span>
                </span>
                <span class="sub visible-xs">
                  <span ng-if="vm.isValidDate(vm.stats.first_occurrence)">{{vm.stats.first_occurrence | date:'M/d' }}</span>
                  <span ng-if="!vm.isValidDate(vm.stats.first_occurrence)">NA</span>
                </span>
              </div>
            </div>
          </div>
          <div class="col-xs-4">
            <div class="dashboard-block">
              <div class="rotate">
                <i class="fa fa-arrow-circle-right  fa-4x"></i>
              </div>
              <div class="details">
                <span class="title">End</span>
                <span class="sub visible-md visible-lg"><timeago date="vm.stats.last_occurrence"></timeago></span>
                <span class="sub visible-sm">
                  <span ng-if="vm.isValidDate(vm.stats.last_occurrence)">{{vm.stats.last_occurrence | date:'shortDate' }}</span>
                  <span ng-if="!vm.isValidDate(vm.stats.last_occurrence)">never</span>
                </span>
                <span class="sub visible-xs">
                  <span ng-if="vm.isValidDate(vm.stats.last_occurrence)">{{vm.stats.last_occurrence | date:'M/d' }}</span>
                  <span ng-if="!vm.isValidDate(vm.stats.last_occurrence)">NA</span>
                </span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="panel panel-default">
      <div class="panel-heading"><i class="fa fa-fw fa-calendar"></i> Session Overview</div>
      <div class="panel-body">
        <table class="table table-striped table-bordered table-fixed table-key-value b-t">
          <tr>
            <th>Project</th>
            <td><a ui-sref="app.session-project-dashboard({ projectId: vm.project.id })">{{vm.project.name}}</a></td>
          </tr>
          <tr>
            <th>Session</th>
            <td>{{vm.event.session_id}}</td>
          </tr>
        </table>

        <div ng-if="vm.hasUserEmail() || vm.hasUserDescription() || vm.hasIdentity() || vm.hasUserName()">
          <h4>User Info</h4>
          <table class="table table-striped table-bordered table-fixed table-key-value b-t">
            <tr ng-if="vm.hasUserEmail()">
              <th>User Email</th>
              <td><a ng-href="mailto:{{::vm.event.data['@user_description'].email_address}}" truncate>{{::vm.event.data['@user_description'].email_address}}</a>
              </td>
            </tr>
            <tr ng-if="vm.hasIdentity()">
              <th>User Identity</th>
              <td><span truncate>{{::vm.event.data['@user'].identity}}</span></td>
            </tr>
            <tr ng-if="vm.hasUserName()">
              <th>User Name</th>
              <td><span truncate>{{::vm.event.data['@user'].name}}</span></td>
            </tr>
          </table>
        </div>
        <div class="pull-right" ng-if="vm.event.id"><a ui-sref="app.event({ id: vm.event.id })">View more</a></div>
      </div>
    </div>

    <div class="panel panel-default">
      <div class="panel-heading"><i class="fa fa-fw fa-calendar"></i> Session Events</div>
      <events settings="vm.sessionEvents"></events>
    </div>
  </div>
</div>
